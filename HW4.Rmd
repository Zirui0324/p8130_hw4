---
title: "HW4"
output: html_document
date: "2022-11-12"
---

```{r message=FALSE}
library(tidyverse)
library(BSDA)
library(readxl)
library(readr)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE)
```

## Problem1

```{r}
blood_data = c(125, 123, 117, 123, 115, 112, 128, 118, 124, 111, 116, 109, 125, 120, 113, 123, 112, 118, 121, 118, 122, 115, 105, 118, 131)
blood_test_data = blood_data - 120
test1 = SIGN.test(blood_test_data, alternative = "less", conf.level = 0.95)
```

* a)
  According to the sign-test above, we can see that the test statistic is **`r test1$statistic`** with p-value **0.2706**. Thus we fail to reject the null hypothesis under a 0.05 significant level and claim that the median blood sugar readings was 120 in the population from which the 25 patients were selected.
 
```{r}
test2 = wilcox.test(blood_test_data, alternative = "less", conf.level = 0.95)
``` 
* b)
  According to Wilcoxon signed-rank test, we can see that the test statistic is **`r test2$statistic`** with p-value **0.1447**. Thus we fail to reject the null hypothesis under a 0.05 significant level and claim that the median blood sugar readings was 120 in the population from which the 25 patients were selected.
  
  
## Problem 2
```{r}
brain_data = 
  read_xlsx("./Brain.xlsx")[-c(1),] %>% 
  janitor::clean_names()

brain_fit = 
  lm(glia_neuron_ratio ~ ln_brain_mass, data = brain_data) 

brain_fit %>% 
  broom::tidy()
```
* a) 
  The linear model for the nonhuman data using ln (brain mass) as the predictor is : **y = 0.181x + 0.164**.

```{r}
y_0 = 0.181*7.22 + 0.164
```

* b)
  The predicted glia-neuron ratio for humans is **`r y_0`**.

* c)
  I assume the most plausible range of values for the prediction is an interval for the prediction of a single new observation.
  
* d)
  Construct the 95% interval chosen in part (c). On the basis of your result, does the human brain have an excessive glia-neuron ratio for its mass compared with other primates

* e)


## Problem 3
```{r}
heart_data = 
  read.csv("./HeartDisease.csv") %>% 
  mutate(
    gender = as.factor(gender),
    gender = recode(gender, "0" = "otherwise", "1" = "male")
         )
  
```

* a)
  The main predictor of this dataset is **total cost**, The main outcome is **number of emergency room visits**.
  Other important covariates: **age, gender, complications, duration**.
  Here are some descriptions of the important variables:
  
```{r}
summary(heart_data$totalcost)
summary(heart_data$ERvisits)
summary(heart_data$age)
summary(heart_data$complications)
summary(heart_data$duration)

gender_sum = 
  heart_data %>% 
  group_by(gender) %>% 
  summarise(count = n())

  barplot(height = gender_sum$count,
          names = gender_sum$gender)
```


* b)
  Investigate the shape of the distribution for variable totalcost and try different transformations, if needed.
  
```{r}
hist(heart_data$totalcost, xlab = "Total Cost", breaks = 100)
hist((heart_data$totalcost)^2, xlab = "ln(Total Cost)", breaks = 100)
hist((heart_data$totalcost)^(-1), xlab = "ln(Total Cost)", breaks = 100)
hist(log(heart_data$totalcost), xlab = "ln(Total Cost)", breaks = 100)
```

It seems that the plot best fits normality after ln-transformation.

```{r}
heart_data = 
  heart_data %>% 
  filter(totalcost > 0) %>% 
  mutate(ln_cost = log(totalcost))

shapiro.test(heart_data$ln_cost)
```
  
The Shapiro Test shows that total cost data doesn't follow normal distribution after ln-transformation.

* c)

```{r }
heart_data = 
  heart_data %>% 
  mutate(
    comp_bin = 
      case_when(
        complications == 0 ~ "0",
        TRUE ~ "1"
      ))
```

* d)
```{r}
plot(heart_data$ERvisits, heart_data$ln_cost)

heart_data %>% 
  ggplot()+
  geom_point(aes(x = ERvisits, y = ln_cost))+
  theme_bw()+
  labs(x = "Number of Emergency Room Visits",
       y = "ln(Total Cost)")

heart_fit = 
  lm(ln_cost ~ ERvisits, data = heart_data)

summary(heart_fit)

t_cri = qt(p=.05/2, df=783, lower.tail=FALSE)
t_cri
```
The slope is 0.22672, at a 5% significance level, t > t783,0.975, we reject the null and conclude that there is a significant linear association between the number of Emergency room visits and ln(Total cost).

* e)
  1)Test if comp_bin is an effect modifier of the relationship between totalcost and ERvisits. Comment.
  interaction
```{r}
fit_1 = 
  lm(ln_cost ~ ERvisits + comp_bin, data = heart_data)
fit_1|>summary()

```

  2)
```{r}

```

  Test if comp_bin is a confounder of the relationship between totalcost and
ERvisits. Comment.
  confounder

  3)
```{r}
fit_1|>anova()
```

  From the ANOVA test above we can tell that comp_bin should be included with ERvisits as the p-value is less than 0.05.
  
* f)



